# 声明 
本文是学习[github5.com 网站的报告](https://siduwenku.com/view/list/report?f=first)而整理的学习笔记,分享出来希望更多人受益,如果存在侵权请及时联系我们
# 密钥管理框架  
  
## 概要  
  
本章包含了对密钥建立机制框架的高级描述，定义了四种机制（双方密钥协商，三方密钥协商，私钥传送以及公钥传送）以及各自的使用要求，这些机制的特性参见附录B。  
  
## 双方密钥协商  
  
本节适用于本部分第11.1-11.11描述的双方密钥协商的密钥协商机制。双方密钥协商是一个在*A*与*B*两实体间建立共享密钥的过程，任何一方不能预先确定共享密钥的值。密钥协商机制可以提供隐式密钥鉴别；在密钥建立的条件下，隐式密钥鉴别意味着机制实施后只有经确定的实体才可拥有正确的共享密钥。  
  
*A*与*B*两实体间的密钥协商发生在双方共享一段内容的条件下。该内容包括两个集合*S*1,S2和一个密钥协商函数F。函数F应满足以下规定：  
  
1.  F:*S*1\**S*2→*S*2将元素(*h*,*g*)∈*S*1\** S*2映射到*S*2的元素，写成*y*=F(*h*,*g*) ；  
2.  F满足可交换：  
  
F(*hA*,F(*hB*,*g*))=F(*hB,*F(*hA,g*)) ；  
  
1.  从F(*h*1,*g*),F(*h*2,*g*)和*g*计算得到F(*h*1,F(*h*2,*g*))是困难的，意味着F(.,*g*)是单向函数；  
2.  实体*A*和*B*共享*S*2中的一个公共元素*g*，该元素是公开的；  
3.  此设置下的实体可以高效计算函数值F(*h*,*g*)，并有效地产生*S*1中的随机元素。在特定的密钥协商中，可进一步包括一些条件。  
  
注1：附录D和附录E给出密钥协商函数F的例子。  
  
注2：如第6章中描述，在密钥协商机制的实际实现时对共享密钥做进一步处理。  
  
注3：一般来讲，若收到的函数值F(*h*,*g*)为弱值，该协议将终止。  
  
## 三方密钥协商  
  
本节适用于描述第11.12描述的三方之间密钥协商的密钥协商机制。三方密钥协商在三个*实体A*,*B*,*C*间建立一个共享密钥，三方中的任何一方不能预先确定共享密钥的值。三实体*A*,*B*,*C*间的密钥协商发生在三方共享一段内容的条件下，该内容包括三个集合*S*1,*S*2,*S*3，密钥协商函数F和FP。密钥协商函数F和FP应满足以下规定：  
  
1.  F:*S*1\**S*2-\>*S*2将元素(*h*,*g*)∈*S*1\** S*2映射到*S*2的元素，写成*y*=F(*h*,*g*) ；  
1.  F满足可交换：  
  
F(*hA*,F(*hB*,*g*))=F(*hB*,F(*hA*,*g*)) ；  
  
1.  从F(*h*1,*g*),F(*h*2,*g*)和*g*计算F(*h*1,*F*(*h*2,*g*))是困难的，意味着F(.,*g*)是单向函数；  
1.  F:*S*1\**S*2\** S*2-\>*S*3将元素(*hC*,F(*hA*,*g*),F(*hB*,*g*))∈*S*1\**S*2\**S*2映射到*S*3的元素，写成：  
  
z=FP(*hC*,F(*hA*,*g*),F(*hB*,*g*)) ；  
  
1.  FP满足可交换性：  
  
FP(*hC*,F(*hA*,*g*),F(*hB*,*g*))=FP(*hC*,F(*hB*,*g*),F(*hA*,*g*))=FP(*hB*,F(*hA*,*g*),F(*hC*,*g*))  
  
=FP(*hA*,F(*hB*,*g*),F(*hC*,*g*))=FP(*hA*,F(*hC*,*g*),F(*hB*,*g*))=FP(*hB*,F(*hC*,*g*),F(*hA*,*g*)) ；  
  
1.  从F(*hA*,*g*),F(*hB*,*g*),F(*hC*,*g*)和*g*计算得到FP(*hC*,F(*hA*,*g*),F(*hB*,*g*))是困难的，意味着F(.,*pA*,*pB*)是单向函数；  
2.  实体*A*,*B*,*C*共享一个*S*2中的一个公共元素*g*，该元素是公开的；  
3.  此设置下的实体可以高效计算函数值F(*h*,*g*)和FP(*hC*,F(*hA*,*g*),F(*hB*,*g*))，并有效地产生在*S*1中的随机元素。在特定的密钥协商中，可进一步包括一些条件。  
  
注：如第6章描述，在密钥协商机制的实际实现中对共享密钥做进一步处理，共享派生密钥通常采用以下方法计算：  
  
1）直接从共享密钥*KABC*提取一些比特位；或  
  
2）将共享密钥*KABC*和选用一些非秘密数据经过一个单向函数计算，从输出中提取一些比特位。  
  
## 秘密密钥传送  
  
秘密密钥传送（也称密钥传递）是一个传递秘密密钥的过程，由一实体（或可信任中心）选择，传给另一实体，并通过非对称密码算法加密保护。  
  
## 公钥传送  
  
公钥传送使一实体的公钥可让其它实体以鉴别方式得到，公钥鉴别分发是一个基本的安全需求。分发主要通过以下两种方式：  
  
1.  没有可信第三方的公钥分发；  
2.  通过可信第三方的公钥分发，例如证书颁发机构。  
  
实体*A*的公钥是实体*A*公钥信息的一部分，公钥信息至少包括实体*A*的区分标识符和实体*A*的公钥。  
  
## 密钥协商  
  
### 密钥协商机制1  
  
该密钥协商机制以非交互方式在实体*A*和*B*间建立包含相互隐式密钥鉴别的共享密钥，应满足以下规定：  
  
1.  每个实体*X在S*1中有一个密钥协商私钥*hX*和一个密钥协商公钥*p*X=F(*hX*,*g*)；  
2.  每个实体可得到另一实体的已鉴别的密钥协商公钥副本，可用第13章描述的机制来实现。  
  
密钥协商机制1如图1所示。该机制用于以离线方式在两个实体之间协商共享密钥。  
  
1.  密钥协商机制1  
  
**密钥建立（A1）：** 实体*A*用其私钥协商密钥*hA*和实体*B*的公钥协商密钥*pB*计算共享秘密密钥*KAB*=*F*(*hA*,*pB*)。  
  
**密钥建立（B1）：** 实体*B*用其私钥协商密钥*hB*和实体*A*的公钥协商密钥*pA*计算共享私钥*KAB*=F(*hB*,*pA*)。在第10章中对F进行了规定，以保证密钥*KAB*的两个计算值一致。  
  
1.  1：交互次数为0。  
2.  2：该机制提供了相互隐式密钥鉴别。该非交互协议将产生相同的密钥。解决该问题的方法是确保密钥只用一次。也可用唯一的初始化矢量与密钥一起使用来解决该问题。  
3.  3：该机制不提供密钥确认。  
4.  4：该机制是一个密钥协商机制，它建立的密钥是实体*A*和*B*的私钥*hA*和*hB*的单向函数。然而，一实体可能在选择私钥前就知道另一实体的公钥。因此，如第8章所描述，一实体可选择所建立密钥的*s*位，代价是在发现另一个实体的公钥和选择私钥的间隔中，为私钥产生2*s*个备选值。  
  
### 密钥协商机制2  
  
该机制适用于参与协商密钥的两个实体中仅有一方知道对方身份，且只需在线交互一次的场景，采用实体*B*到*A*的隐式密钥鉴别方式，在实体*A*和实体*B*间经一次交互建立一个共享私钥，但实体*B*不鉴别实体*A*（即实体*B*不知道和谁建立共享密钥）。该机制需满足以下规定：  
  
1.  实体*B在S*1中有一个密钥协商私钥*hB*和一个密钥协商公钥*pB*=F(*hB*,*g*)；  
2.  实体*A*可以通过第13章描述的机制获得实体*B*已鉴别的密钥协商公钥*pB*的副本。  
  
密钥协商机制2如图2所示。  
  
**密钥权标创建(A1)：** 实*A*随机并秘密产生*r*（*r*在*S*1中），计算F(*r*,*g*)，并将密钥权标：*KTA*1=F(*r*,*g*)\|\|Text发送给实体*B*。  
  
**密钥创建(A2)：** 实体*A*计算共享密钥*KAB*=F(*r*,*pB*)。  
  
**密钥创建(B1)：** 实体*B*从接收到的密钥权标*KTA*1中提取F(*r*,*g*)，并计算共享密钥：*KAB*=F(*hB*,F(*r*,*g*))。在第10章中对F进行了规定，以保证密钥*KAB*的两个计算值一致。  
  
1.  1：交互次数为1。  
2.  2：该机制提供从实体*B*到实体*A*的隐式鉴别（实体*B*是除了实体*A*之外唯一可计算出共享密钥的实体）。  
3.  3：该机制不提供密钥确认。  
4.  4：该机制是一个密钥协商机制，它建立的密钥是实体*A*提供的随机值*r*和实体*B*的密钥协商私钥的单向函数。因此，如第8章所描述，实体*A*可在选取*r*的值之前就得到实体*B*的公钥，实体*A*可选择所建立密钥的*s*位，代价是在发现实体*B*的公钥和发送*KTA*的间隔中，为*r*产生2*s*个备选值。  
5.  5：由于实体*B*是从未鉴别的实体*A*收到可计算出密钥*KAB*的信息，实体*B*对*KAB*的使用须被限制在不需实体*A*鉴别的范围内，例如，解密和消息鉴别码的生成。  
1.  密钥协商机制2及机制8  
  
### 密钥协商机制3  
  
该机制适用于参与协商密钥的两个实体彼此知道对方身份，且只需在线交互一次的场景，通过相互隐式密钥鉴别以及实体*A*到实体*B*的实体鉴别，在实体*A*和实体*B*间经一次交互建立共享秘密密钥。应满足以下要求:  
  
1.  实体*A*拥有非对称签名系统(S*A*,V*A*)；  
2.  实体*B*可得到已鉴别的公开验证变换V*A*的副本，可通过第13章所描述的机制实现；  
3.  实体*B*有密钥(*hB*,*pB*)的密钥协商方案；  
4.  实体*A*可获取已鉴别的实体*B*密钥协商公钥*pB*的副本，可通过第13章所描述的机制实现；  
5.  (可选)如果被使用,TVP可为时间戳或序列号。如果使用时间戳,需有安全和同步的时钟；如果使用序列号,则需维护和校验双边计数器；  
6.  实体*A*和*B*在MAC函数和使用*KAB*作为该MAC函数密钥的方法上应一致。MAC函数参见ISO/IEC 9797。  
  
密钥协商机制3如图3所示。  
  
1.  密钥协商机制3  
  
**密钥创建(A1.1)：** 实体*A*随机并秘密产生*r*（*r*在*S*1中），计算F(*r*,*g*)，按*KAB*=F(*r*,*pB*)计算共享秘密密钥。实体*A*使用共享秘密密钥*KAB*对发送者实体*A*的区分标识符及可选的TVP（时间戳或序列号）的级联，计算出MAC。  
  
**密钥权标签名(A1.2):**  实体*A*用其私有签名转换S*A*对MAC进行签名。实体*A*形成密钥权标,它由发送者实体*A*的区分标识符、密钥输入F(*r*,*g*)、TVP(可选)、已签名的MAC和一些可选数据组成,即  
  
*KTA*1=A\|\|F(*r*,*g*)\|\|TVP\|\|S*A*(MAC*KAB*(A\|\|TVP))\|\|Text1  
  
然后将它发送给实体*B*。  
  
**密钥创建(B1.1):**  实体*B*从接收到的密钥权标中提取出F(*r*,*g*)，并用其私钥协商密钥*hB*计算共享秘密密钥,*KAB*=F(*hB*,F(*r*,*g*))。  
  
实体*B*使用共享秘密密钥*KAB*对发送者实体*A*的区分标识符和(可选)TVP计算出MAC。  
  
**签名验证(B1.2):**  实体*B*使用发送者的公开验证转换V*A*验证实体*A*的签名以及接收到的密钥权标*KTA*1的完整性和来源。然后验证权标的及时性(通过检查（可选）TVP)。  
  
1.  1：交互次数为1。  
2.  2：该机制提供从实体*A*到实体*B*的显式密钥鉴别和从实体*B*到实体*A*的隐式密钥鉴别。  
3.  3：该机制提供从实体*A*到实体*B*的密钥确认。  
4.  4：该机制是一个密钥协商机制，它建立的密钥是实体*A*提供的随机值*r*和实体*B*的私钥协商密钥的单向函数,如第8章所描述，实体*A*可在选取*r*的值之前就得到实体*B*的公钥，实体*A*可选择所建立密钥的*s*位，代价是在发现实体*B*的公钥和发送*KTA*的间隔中，为*r*产生2*s*个备选值。  
5.  5：(可选)TVP防止从实体*A*向实体*B*的密钥权标重放。  
6.  6：如果Text1被用来传送实体*A*的公钥证书,那么第11.3的要求2可放宽到实体*B*拥有一个已鉴别的CA公开密钥副本。  
  
### 密钥协商机制4  
  
该机制适用于参与协商密钥的两个实体彼此不知道对方身份，且在线交互两次的场景，实体*A*和*B*事先没有交换密钥信息，通过采用联合密钥控制方法，经两次交互建立共享秘密密钥。该机制既不提供实体鉴别也不提供密钥鉴别。密钥协商机制4如图４所示。  
  
**密钥权标创建(A1):** 实体*A*随机并秘密产生*rA*（*rA*在*S*1中），计算F(*rA*,*g*),构造密钥权标*KTA*1=F(*rA*,*g*)\|\|Text1,然后发给实体*B*。  
  
**密钥权标创建(B1):** 实体*B*随机并秘密产生*rB*（*rB*在*S*1中）,计算F(*rB*,*g*),构造密钥权标*KTB*1=F(*rB*,*g*)\|\|Text2,然后发给实体*A*。  
  
**密钥创建(A2):**  实体*A*从收到的密钥权标*KTB*1中提取F(*rB*,*g*)，并计算共享密钥*KAB*=F(*rA*,F(*rB*,*g*))。  
  
**密钥创建(B2):**  实体*B*从收到的密钥权标*KTA*1中提取F(*rA*,*g*)，并计算共享密钥*KAB*=F(*rB*,F(*rA*,*g*))。  
  
1.  1：交互次数为2。  
2.  2：该机制不提供显式或隐式密钥鉴别，但该机制可用于通过其它方式核实密钥权标的真实性的情况。例如,可通过第二通信信道在实体间交换密钥权标的杂凑码。参见公钥传送机制2。  
3.  3：可采用单独的信道或方法核实密钥权标。  
4.  4：该机制不提供密钥确认。  
5.  5：该机制是一个密钥协商机制，它建立的密钥是实体*A*和实体*B*提供的随机值*rA*和*rB*的单向函数，如第8章所描述,实体*B*可在选择*rB*的值之前就得到F(*rA*,*g*),实体*B*可选择所建立密钥的*s*位，代价是在接收*KTA*1和发送*KTB*1的间隙中，为*rB*产生2*s*个备选值。  
  
密钥协商机制4如图4所示。  
  
1.  密钥协商机制4，5，9  
  
### 密钥协商机制5  
  
该机制适用于参与协商密钥的两个实体彼此知道对方身份，且在线交互两次的场景，通过相互显式密钥别和联合密钥控制方法，经两次交互在实体*A*和*B*间建立一个共享秘密密钥。应满足以下条件:  
  
1.  每个实体*X*有一个私钥协商密钥*hX*（*hX*在*S*1中）,和一个公钥协商密钥pX=F(*hX*,g)；  
2.  每个实体可获取其它实体的已鉴别的公钥协商密钥副本，可通过第13章所描述的机制实现；  
3.  两个实体有共同的单向函数w。  
  
密钥协商机制5如图4所示。  
  
**密钥权标创建(A1):** 实体*A*随机和秘密地产生*rA*（*rA*在*S*1中），计算F(*rA*,*g*),并将密钥权标*KTA*1＝F(*rA*,*g*)\|\|Text1发送给实体*B*。  
  
**密钥权标创建(B1):** 实体*B*随机和秘密地产生*rB*（*rB*在*S*1中）,计算F(*rB*,*g*), 并将密钥权标*KTB*1＝F(*rB*,*g*)\|\|Text2发送给实体*A*。  
  
**密钥创建(B2):**  实体*B*从收到的密钥权标*KTA*1中提取F(*rA*,*g*),并计算共享秘密密钥:  
  
*KAB*=w(F(*hB*,F(*rA*,*g*))\|\|F(*rB*,*pA*)),其中w为单向函数。  
  
**密钥创建(A2):**  实体*A*从收到的密钥权标*KTB*1中提取F(*rB*,*g*),并计算共享秘密密钥：  
  
*KAB*=w(F(*rA*,*pB*)\|\|F(*hA*,F(*rB*,*g*)))。  
  
1.  1：交互次数为2。  
2.  2：该机制提供相互隐式密钥鉴别。如果数据域Text2含有一个由密钥*KAB*对已知数据计算得到的MAC,则该机制提 供实体*B*到实体*A*的显式密钥鉴别。  
3.  3：如果数据域Text2含有一个由密钥*KAB*对已知数据计算得到,则该机制提供实体*B*到实体*A*的密钥确认。  
4.  4：该机制是一个密钥协商机制,它建立的密钥是实体*A*和实体*B*提供的随机值*rA*和*rB*的单向函数。  
5.  5：如果Text1和Text2分别包含实体*A*和实体*B*的密钥协商密钥的公钥证书,则第11.5的要求2替代为:每个实体拥有一个已鉴别的CA公开验证密钥副本。  
6.  6：在某种情况下该机制可能会遭受源替换攻击，考虑到这种情况,可以这样来避免这种攻击：作为提交公钥给CA获得证书的一部分，提交者应证明其持有相应私钥。该类攻击对于基于椭圆曲线的协议更为严重。  
  
### 密钥协商机制6  
  
该机制适用于参与协商密钥的两个实体彼此鉴别对方身份，且在线交互两次的场景，基于同时使用非对称加密方案和签名系统，通过相互隐式密钥鉴别和联合密钥控制，经两次交互在实体*A*和*B*间建立一个共享密钥。应满足以下要求：  
  
1.  实体*A*具有非对称加密系统及变换（E*A*，D*A*）；  
2.  实体*B*具有非对称签名系统及变换（S*B*，V*B*）；  
3.  实体*A*可得到经鉴别的实体*B*公钥验证变换V*B*副本，可使用第13章的机制来实现；  
4.  实体*B*可得到经鉴别的实体*A*的公钥加密变换E*A*副本，可使用第13章的机制来实现。  
  
密钥协议机制6如图5所示。  
  
1.  密钥协商机制6  
  
**密钥权标创建(A1):** 实体*A*产生随机数*rA*，创建密钥权标*KTA*1=*rA*\|\|Text1，并将其发送给实体*B*。  
  
**密钥权标处理(B1):** 实体*B*产生随机数*rB*，使用其私有签名变换S*B*，对数据块签名，该数据块的组成是：实体*A*的区分标识符、随机数*rA*、随机数*rB*和可选数据文本Text2，得到*BS*=S*B*(A\|\|*rA*\|\|*rB*\|\|Text2)。  
  
然后实体*B*用实体*A*的基于公钥加密变换E*A*对数据块加密，该数据块的组成是：区分标识符（可选）、签名块*BS*及可选的数据Text3，实体*B*将密钥权标*KTB*1=E*A*(*BS*\|\|Text3)\|\|Text4返回给实体*A*，或实体*B*可包括其标识符*B*：*KTB*1=E*A*(B\|\|*BS*\|\|Text3)\|\|Text4。  
  
**密钥创建(B2):** 经密钥派生函数，共享秘密密钥由签名块*BS*中实体*B*所有或其中一部分签名Σ组成（见第4章注2）。  
  
**密钥权标处理(A2):** 实体*A*使用其私有解密变换D*A*解密密钥权标*KTB*1，检查发送者的标识（可选），并采用实体*B*的公钥验证变换V*B*验证签名块*BS*的数字签名。然后实体*A*检查接收者标识符和签名块*BS*中随机数*rA*是否等于在发送的权标*KTA*1中的随机数*rA*。如果所有检查都成功，实体*A*接受所有采用密钥派生函数的签名块*BS*中实体*B*所有或其中一部分签名作为共享秘密密钥。  
  
1.  1：交互次数为2。  
2.  2：将签名Σ部分作为实体*A*和*B*间建立的秘密密钥的基础，需提前商定。  
3.  3：该机制提供从实体*A*与实体*B*的隐式密钥鉴别和从实体*B*向实体*A*的显式密钥鉴别。  
4.  4：如果Text3包含用密钥*KAB*对已知数据计算出的MAC，则该机制提供实体*B*向实体*A*密钥确认。  
5.  5：该机制是一个密钥协商机制，它建立的密钥是由实体*A*和实体*B*提供的随机值*rA*和*rB*的单向函数，如第8章所讨论,实体*B*可在选择*rB*的值之前就得到F(*rA*,*g*),实体*B*可选择所建立密钥的*s*位，代价是在接收*KTA*1和发送*KTB*1的间隙中，为*rB*产生2*s*个备选值。  
6.  6：如果Text1和Text4分别包含有实体*A*加密密钥的公钥证书的和实体*B*验证密钥的公钥证书，则第11.6节的要求3和4可放宽到：每个实体拥有已鉴别的CA公开验证密钥副本。  
7.  7：该机制有一个显著特征，实体*B*的身份可对窃听者匿名，这是无线通信环境中有潜在意义的属性。  
  
### 密钥协商机制7  
  
该机制适用于参与协商密钥的两个实体采用GB/T 15843.3-2016规定的三轮交互鉴别机制彼此鉴别对方身份，且在线交互两次的场景，通过相互鉴别在实体*A*和*B*间建立共享秘密密钥。应满足以下要求：  
  
1.  每个实体*X*有一个非对称签名系统（S*X，*V*X*）；  
2.  实体双方均可得到另一实体已鉴别的公开验证变换副本，可使用第13章的机制来实现；  
3.  两实体使用同一MAC函数。  
  
密钥协商机制7如图6所示。  
  
**密钥权标创建(A1):** 实体*A*随机及秘密生成*rA*（*rA*在*S*1中），计算F（*rA*,*g*），构建密钥权标*KTA*1=F(*rA*,*g*)\|\|Text1，并将其发送给实体*B*。  
  
**密钥权标处理及密钥创建(B1):** 实体*B*随机及秘密生成*rB*（*rB*在*S*1中），计算F（*rB*,*g*），计算共享密钥：*KAB*=F（*rB*，F（*rA*，*g*）），并构建签名密钥权标*KTB*1=S*B*(*DB*1)\|\|MAC*KAB*(*DB*1)\|\|Text3,其中*DB*1=F(*rB*,g)\|\|F(*rA*,g)\|\|A\|\|Text2，并送回给实体*A*。  
  
通过在*KTB*1中包含MAC*KAB*（*DB*1）提供密钥确认。如果双方有一个共同的对称加密系统，用*KTB*1=\|\|E*KAB*（S*B*（*DB*1））取代*KTB*1提供密钥确认，其中E是对称加密函数。  
  
**密钥权标处理(A2):** 实体*A*使用实体*B*的公开验证密钥验证实体*B*对密钥权标*KTB*1的签名，然后验证*A*的区分标识符以及步骤（A1）中F（*rA*，*g*）值。如果检查成功，实体*A*计算共享秘密密钥:  
  
*KAB*=F（*rA*，F（*rB*，*g*））。  
  
实体*A*使用*KAB*，验证MAC*KAB*（*DB*1），构造经签名的密钥权标：*KTA*2=S*A*（*DB*2）\|\|MAC*KAB*（*DB*2）\|\|Text5，其中*DB*2=F(*rA*,*g*)\|\|F(*rB*,*g*)\|\|B\|\|Text4，并发送给实体*B*。  
  
通过在*KTA*2中包含MAC*KAB*（*DB*2）提供密钥确认。也可用*KTA*2=E*KAB*（S*A*（*DB*2））取代*KTA*2提供密钥确认。  
  
**密钥权标处理(B2):** 实体*B*使用实体*A*的公开验证密钥验证实体*A*对密钥权标*KTA*2的签名，然后验证实体*B*的区分标识符以及F（*rA，g*）和F（*rB，g*）的值是否与之前协商的一致。如果验证成功，实体*B*使用*KAB*=F(*rB*,F(*rA*,*g*))验证MAC*KAB*（*DB*2）。  
  
1.  1：交互次数为3。  
2.  2：该机制提供相互显式密钥鉴别和相互实体鉴别。  
3.  3：该机制提供相互密钥确认。  
4.  4：该机制是一个密钥协商机制，它建立的密钥是实体*A*和实体*B*提供的随机值*rA*和*rB*的单向函数，如第8章所讨论实体*B*可在选择*rB*的值之前就得到F(*rA*,*g*),实体*B*可选择所建立密钥的*s*位，代价是在接收*KTA*1和发送*KTB*1的间隙中，为*rB*产生2*s*个备选值。  
5.  5：该机制符合GB/T 15843.3-2016。*KTA*1，*KTB*1和*KTA*2与GB/T 15843.3-2016的第5.2.2描述的三轮交互鉴别机制的权标相同。TVP也相同，在下列使用上做些改变：将*RA*（GB/T 15843.3-2016的三个权标，5.2.2）设置为F（*rA,g*）；以及将*RB*（GB/T 15843.3-2016的三个权标，5.2.2）设置为F（*rB,g*）。  
6.  6：如果数据域Text1和Text3（或Text5和Text3）分别包含实体*A*和*B*的公钥证书，则第11.7的第二个要求可放宽  
7.  8：每个实体拥有一份已鉴别的CA公开验证密钥副本。  
8.  9：如果使用带有文本杂凑的签名机制，则F（*rA*,*g*）及/或F（*rB*,*g*）不需在密钥权标*KTB*1中发送。同样，F（*rA*,*g*）  
9.  10：F（*rB*,*g*）不需在密钥权标*KTA*2中发送，但在各签名的计算中应包括随机数。  
10. 11：密钥确认也可通过加密签名中的一部分来实现，在这种情况下，在第11.7中的第三要求可不采用。  
11. 密钥协商机制7  
  
### 密钥协商机制8  
  
该机制适用于参与协商密钥的两个实体采用椭圆曲线密码算法且在线交互一次的场景，通过相互隐式密钥鉴别及一次交互在实体*A*和*B*间建立一个共享秘密密钥。应满足以下要求：  
  
1.  每个实体*X*在*S*1中都有一个私钥协商密钥*hX*和**一** 个公钥协商密钥*pX*=F（*hX*,*g*）；  
2.  每个实体可得到另一个实体已鉴别的公钥协商密钥副本，可使用第13章的机制来实现。  
  
密钥协商机制8如图2所示。  
  
*l*和*j*值用于余子式乘法（见第7章）。还需采用一个函数将一椭圆点*P*转换为整数，例如，函数π(*P*)=(X(*P*)mod2*ρ*/2)+2*ρ*/2，其中*ρ=log*2*n*，X(*P*)为点*P*的*x*坐标。  
  
**密钥权标创建(A1):**  实体*A*随机并秘密地产生*rA*（*rA*在*S*1中），计算F(*rA*,*g*)，构建密钥权标*KTA*1= F(*rA*,*g*)，并将其发送给实体*B*。  
  
**密钥创建(A2):** 实体*A*计算共享秘密密钥：*KAB*=*lj*(1+π(*pB*))(F(*rA*,*pB*)+π(*KTA*1)F(*hA*,*pB*))  
  
**密钥创建(B1):** 实体*B*计算共享秘密密钥：*KAB*=*lj*(1+π(*pB*))(F(*hB*,*KTA*1)+π(*KTA*1)F(*hB*,*pA*))  
  
1.  1：交互次数为1。  
2.  2：该机制提供相互隐式密钥鉴别。  
  
### 密钥协商机制9  
  
该机制适用于参与协商密钥的两个实体采用椭圆曲线密码算法且在线交互两次的场景，通过相互隐式密钥鉴别，经两轮交互在实体*A*和实体*B*间建立一个共享秘密密钥。应满足下面条件:  
  
1.  每个实体*X*在*S*1中有一个私钥协商密钥*hx*和一个公钥协商密钥*px*=F(*hx*,g)；  
2.  每个实体可得到另一个实体已鉴别的公钥协商密钥副本，可使用第13章的机制来实现。  
  
密钥协商机制9如图4所示。  
  
*l*和*j*值用于余子式乘法（见第7章）。还需采用一个函数将一椭圆点*P*转换为整数，例如，函数π(*P*)=(*X*(*P*)mod2*ρ*/2)+2*ρ*/2，其中*ρ=log*2*n*，X(*P*)为点*P*的*x*坐标。  
  
**密钥权标创建(A1):** 实体*A*随机及秘密地产生*rA*（*rA*在*S*1中）,计算F(*rA*,*g*),构建密钥权标*KTA*1=F(*rA*,*g*),然后发给实体*B*。  
  
**密钥权标创建(B1):** 实体*B*随机及秘密地产生*rB*（*rB*在*S*1中）,计算F(*rB*,*g*),构建密钥权标*KTB*1=F(*rB*,*g*), 然后发给实体*A*。  
  
**密钥创建(A2):** 实体*A*计算共享密钥：*KAB*=*lj*(1+π(*pB*))F(*rA*,*pB*)+π(*KTA*1)F(*hA*,*pB*))  
  
**密钥创建(B2):** 实体*B*计算共享密钥：*KAB*=*lj*(1+π(*pB*))F(*hB*,*KTA*1)+π(*KTA*1)F(*hB*,*pA*))  
  
1.  1：交互次数为2。  
2.  2：该机制提供相互隐式密钥鉴别。  
3.  3：在某些情况下，该机制可能会受到源替换攻击，但可以通过增加延迟检测来避免这种攻击。  
  
### 密钥协商机制10  
  
该机制适用于参与协商密钥的两个实体采用SM2椭圆曲线密码算法且在线交互三次的场景，见GB/T 32918.3-2016。该密钥协商机制采用椭圆曲线密码体制,通过三次交互采用相互隐式密钥鉴别，在实体*A*和实体*B*间建立一个共享密钥。需满足下面条件:  
  
1.  每个实体*X*在*S*1中有一个私钥协商密钥*hx*和一个公钥协商密钥*px*=F(*hx*,*g*)；  
2.  每个实体可得到另一个实体已鉴别的公钥协商密钥副本，可使用第13章的机制来实现。  
  
密钥协商机制10如图7所示。  
  
*l*和*j*值用于余子式乘法（见第7章）。还需采用一个函数将一椭圆点*P*转换为整数，函数*π*(*P*)=(X(*P*)&(2「*ρ*/2*-*1))+2「*ρ*/2**，其中*ρ=*「*log*2*n*，X(*P*)为点*P*的*x*坐标。  
  
1.  密钥协商机制10  
  
**密钥权标创建(A1)** :实体*A*随机及秘密地产生*rA*（*rA*在*S*1中）, 计算F(*rA*,*g*),构建密钥权标*KTA*1=F(*rA*,*g*), 然后发给实体*B*。  
  
**密钥创建(B1):**  实体*B*随机及秘密地产生*rB*（*rB*在*S*1中）,计算F(*rB*,*g*),构建密钥权标*KTB*1=F(*rB*,*g*),计算共享秘密密钥：  
  
*KAB*=((*hB*+π(*KTB*1)*rB*)*l*)(*pA*+π(*KTA*1)*j*(*KTA*1))  
  
实体*B*计算密钥*K*=kdf(*KAB*\|\|*ZA*\|\|*ZB*)。并进一步构建MAC*K*(2\|\|Y(*KAB*)\|\|MAC*K*(X(*KAB*)\|\|*ZA*\|\|*ZB*\|\|*KTA*1\|\| *KTB*1))，然后将*KTB*1及MAC*K*(2\|\|Y(*KAB*)\|\|MAC*K*(X(*KAB*)\|\|*ZA*\|\|*ZB*\|\|*KTA*1\|\|*KTB*1))发给实体*A*。  
  
**密钥创建(A2):** 实体*A*计算共享秘密密钥：  
  
*KAB*=((*hA*+π(*KTA*1)*rA*)*l*)(*pB*+π(*KTB*1)*j*(*KTB*1))，  
  
计算密钥*K*=kdf(*KAB*\|\|*ZA*\|\|*ZB*)及MAC*K*(2\|\|Y(*KAB*)\|\|MAC*K*(X(*KAB*)\|\|*ZA*\|\|*ZB*\|\|*KTA*1\|\|*KTB*1))并验证实体*B*发送的内容。然后计算:  
  
MAC*K*(3\|\|Y(*KAB*)\|\|MAC*K*(X(*KAB*)\|\|*ZA*\|\|*ZB*\|\|*KTA*1\|\|*KTB*1))，然后将其发送给实体*B*。  
  
**验证(B2):** 实体*B*计算MAC*K*(3\|\|Y(*KAB*)\|\|MAC*K*(X(*KAB*)\|\|*ZA*\|\|*ZB*\|\|*KTA*1\|\|*KTB*1))。  
  
1.  1：交互次数为3。  
2.  2：该机制提供相互显式密钥鉴别。  
3.  3：附录E.3给出该机制的一个例子。  
  
### 密钥协商机制11  
  
该机制适用于参与协商密钥的两个实体中仅有一方知道对方身份，且在线交互四次的场景，通过四次交互在实体*A*和实体*B*间建立一个共享密钥，应满足下面条件:  
  
1.  实体*B*有一个采用(E*B,*D*B*)变换的非对称加密系统；  
2.  实体*A*可得到公开验证变换的一个已鉴别副本,用于验证*CertB*；  
3.  双方实体使用同一密钥派生函数kdf。  
  
密钥协商机制11如图8所示。  
  
**实体确认(A1)** ：实体*A*选择一个随机整数*rA*,发送一个消息*M*1=(*rA*\|\|Text1)给实体*B*。  
  
**实体确认(B1)** ：实体*B*选择一个随机整数*rB*,发送一个消息*M*2=(*rB*\|\|*CertB*\|\|Text2)给实体*A*。  
  
**密钥权标和密钥创建(A2)** ：实体*A*验证*CertB*以得到实体*B*公钥的可信副本，并产生一个随机整数*r*'*A*,计算共享密钥*KAB*=kdf(*rA*,*rB*,*r*'*A*)。然后发送密钥权标*KTA*2=E*B*(*r*'*A*)和MAC*KAB*(*M*1\|\|*KTA*2)给实体*B*。  
  
**密钥创建(B2)** ：实体*B*解密*KTA*2,计算共享密钥*KAB*=kdf(*rA*,*rB*,*r*'*A*)。计算MAC*KAB*(*M*1\|\|*KTA*2),并与接收到的MAC值进行比较。实体*B*把MAC*KAB*(*M*2)发给实体*A*。  
  
**密钥验证(A3)** :实体*A*计算MAC*KAB(M2)*,并与接收到的MAC值进行比较。  
  
1.  1：交互次数为4。  
2.  2：该机制提供实体*B*到*A*的隐式密钥鉴别。  
3.  3：该机制源于传输层安全协议(TLS)，在TLS中密钥协商过程称为TLS握手阶段。在TLS中,每个实体有一个“密码套件”,即实体支持的一系列算法。作为“密码套件协商”过程的一部分，Text1和Text2用来交换这些密码套件。  
4.  密钥协商机制11  
  
### 密钥协商机制12  
  
该机制用于以离线方式在三个实体之间协商共享密钥，非交互式地采用相互隐式密钥鉴别在实体*A*、*B*和*C*间建立一个共享密钥，应满足下列条件:  
  
1.  每个实体*X*在*S*1中有一个密钥协商私钥*hX*和一个密钥协商公钥*pX=*F(*hX*,*g*)；  
2.  每个实体可得到其它实体已鉴别的密钥协商公钥副本，可使用第13章的机制来实现。  
  
密码协商机制12如图9所示。  
  
1.  密钥协商机制12  
  
**密钥创建(A1)** ：实体*A*使用自己的私钥协商密钥*hA*、实体*B*的公钥协商密钥*pB*、实体*C*的公钥协商密钥*pC*计算共享秘密密钥*KABC*=FP(*hA*,*pB*,*pC*)。  
  
**密钥创建(B1)** ：实体*B*用自己的私钥协商密钥*hB*、实体*A*的公钥协商密钥*pA*、实体*C*的公钥协商密钥*pC*计算共享秘密密钥*KABC*=FP(*hB*,*pC*,*pA*)。  
  
**密钥创建(C1)** ：实体*C*用自己的私钥协商密钥*hC*、实体*A*的公钥协商密钥*pA*、实体*B*的公钥协商密钥*pB*计算共享秘密密钥*KABC*=FP(*hC*,*pA*,*pB*)。  
  
根据第10章中规定的函数F和FP条件,密钥*KABC*的三个计算值相等。  
  
1.  1：交互次数为0。  
2.  2：该机制提供相互隐式密钥鉴别。然而,这种零交互协议总是产生相同的密钥，一种消除该问题带来隐患的办法是确保该密钥只被使用一次。此外,每次使用该密钥时并用一个唯一初始向量也可以解决该问题。  
3.  3：该机制不提供密钥确认。  
4.  4：这是一个密钥协商机制，它建立的密钥分别是实体*A*、*B*、*C*私钥协商密钥的单向函数。  
  
## 密钥传递  
  
### 密钥传递机制1  
  
该机制适用于参与密钥传递的两个实体中仅有一方知道对方身份，且只需在线交互一次的场景，通过实体*B*到实体*A*的隐式密钥鉴别,经一次交互实体*A*将一个秘密密钥传给实体*B*,应满足以下几个要求:  
  
1.  实体*B*有一个非对称加密系统(E*B*,D*B*)；  
2.  实体*A*能访问实体*B*已鉴别的公开加密变换E*B*副本, 可使用第13章的机制来实现；  
3.  可选的TVP可为一时间戳或一序列号，如果使用时间戳,那么实体*A*和实体*B*须保持时钟同步；如果使用序列号,那么实体*A*和实体*B*须维护双边计数器。  
  
密钥传递机制1如图10所示。  
  
1.  密钥传递机制1  
  
**密钥权标创建(A1)** ：假设*K*是实体*A*希望安全传递给实体*B*的一个秘密密钥。实体*A*创建一个密钥数据块,该数据块包含其可区分标识符(可选)、密钥*K*、一个可选的TVP和一个可选的数据域Text1。实体*A*使用接收者的公开加密变换E*B*对该密钥数据块加密,然后将密钥权标*KTA*1=E*B*(A\|\|*K*\|\|TVP\|\|Text1)\|\|Text2发送给实体*B*。  
  
**密钥权标解构(B1** ):实体*B*使用自己的私有解密变换D*B*将接收到的密钥权标加密部分进行解密,恢复密钥*K*,检查可选的TVP,将恢复的密钥*K*与声称是发送方的实体*A*相关联。  
  
1.  1：交互次数为1。  
2.  2：由于只有实体*B*才能恢复密钥*K*，该机制提供从实体*B*到实体*A*的隐式密钥鉴别。  
3.  3：该机制不提供密钥确认。  
4.  4：实体*A*可选择密钥。  
5.  5：由于实体*B*从未经鉴别的实体*A*接收到密钥*K*,实体*B*对密钥*K*的安全使用限于不需对实体*A*做鉴别的功能。例如,可执行解密和产生消息鉴别码,但不执行加密和验证消息鉴别码。  
  
### 密钥传递机制2  
  
该密钥传递机制是GB/T 15843.3-2016一次交互实体鉴别机制的扩展,适用于参与密钥传递的两个实体只需在线交互一次的场景，它通过实体*A*到实体*B*的显式密钥鉴别,实体*B*到实体*A*的隐式密钥鉴别,从实体*A*传递一个经加密和签名的秘密密钥给实体*B*,应满足以下条件:  
  
1.  实体*A*有一个非对称签名系统(S*A*,V*A*)；  
2.  实体*B*有一个非对称加密系统(E*B*,D*B*)；  
3.  实体*A*能够访问实体*B*已鉴别的公开加密变换E*B*副本,可使用第13章的机制来实现；  
4.  实体*B*能够访问实体*A*已鉴别的公开验证变换V*A*副本,可使用第13章的机制来实现；  
5.  可选的TVP是一时间戳或一序列号,如果使用时间戳,那么实体*A*和实体*B*须保持时钟同步，或使用一可信第三方时间戳机构；如使用序列号,那么实体*A*和实体*B*须维护双边计数器。  
  
密钥传递机制2如图11所示。  
  
**密钥加密(A1.1)** :假设*K*是实体*A*希望安全传递给实体*B*的一个密钥,实体*A*形成一个密钥数据块,该数据块包含发送方可区分识别符、密钥*K*、和一个可选数据域Text1。实体*A*用实体*B*的公开加密变换E*B*对密钥数据块进行加密,形成加密数据块*BE***=**E*B*(A\|\|*K*\|\|Text1)。  
  
**密钥权标创建(A1.2)** :实体*A*创建权标数据块,包括接收者的可区分识别符、可选的TVP(时间戳或序列号),经加密的数据块*BE*和可选的数据域Text2。实体*A*用其私有签名变换S*A*签署数据,附加上可选的Text3,然后形成密钥权标*KTA*1=S*A*(B\|\|TVP\|\|*BE*\|\|Text2)\|\|Text3，发送给实体*B*。  
  
**密钥权标验证(B1.1)** :实体*B*用发送方的公开验证变换V*A*来验证接收的密钥权标中的数字签名,然后实体*B*检查*KTA*1中的识别符和可选的TVP。  
  
**密钥解密(B1.2)** :实体*B*用其私有解密变换D*B*解密块*BE*,然后将包含在块*BE*中的实体*A*的识别符和签名实体的身份进行比较,如果所有的检查成功,那么实体*B*将接受密钥*K*。  
  
1.  1：交互次数为1。  
2.  2：该机制提供了实体*A*到实体*B*的的实体鉴别，该机制还提供从实体*B*到实体*A*的隐式密钥鉴别。  
3.  3：该机制提供了实体*A*到实体*B*的密钥确认。实体*B*确信它与实体*A*分享正确的密钥,但实体*A*在它收到实体*B*用密钥*K*加密答复之后,才能确信实体*B*已经收到该密钥。  
4.  4：可选的TVP提供实体*A*到实体*B*的实体鉴别，并防止密钥权标重放。为了防止密钥数据块*BE*的重放,需在Text1中增加一个TVP。  
5.  5：实体*A*可选择密钥*KA*,因为它是发起实体。类似的,实体*B*也能选择密钥*KB*。联合密钥控制可以通过将实体*A*和实体*B*的密钥*KA*和*KB*结合起来（可通过这个机制的两个例子传递）,形成一个共享秘密密钥*KAB*。联合密钥控制需额外的一次交互。这种结合应是单向的,否则实体*A*就能够选择共享秘密密钥。这种机制可被分类为密钥协商机制。  
6.  6：实体*A*的可区分标识符包括在被加密的块*BE*中,以防止实体*A*的加密密钥块被另一实体盗用。抵抗该攻击的方法是要求实体*B*比较实体*A*的标识符和实体*A*对权标的签名。  
7.  7：与GB/T 15843.3-2016一致,采用公钥算法*KTA*1的实体鉴别和单次鉴别机制的权标发送兼容。通过使用*BE*\|\|Text2取代GB/T 15843.3-2016机制中的Text1，该权标能够帮助密钥*K*的传送。  
8.  8：数据域Text3可用来传递实体*A*的公钥证书,在这种情况下,第12.2的第四个要求可放宽为，实体*B*拥有CA一个已鉴别的公开验证密钥副本。  
9.  密钥传递机制2  
  
### 密钥传递机制3  
  
该密钥传递机制中,实体*A*采用单边密钥确认通过一次交互将经签名及加密的秘密密钥传给实体*B*。该机制适用于参与密钥传递的两个实体只需在线交互一次的场景。应满足以下几个要求:  
  
1.  实体*A*有一个非对称的签名系统(S*A*,V*A*)；  
2.  实体*B*有一个非对称的加密系统(E*B*,D*B*)；  
3.  实体*A*得到实体*B*已鉴别的公开加密变换E*B*副本, 可使用第13章的机制来实现；  
4.  实体*B*得到实体*A*已鉴别的公开鉴别变换V*A*副本, 可使用第13章的机制来实现；  
5.  可选的TVP是一时间戳或一序列号,如果使用时间戳,那么实体*A*和实体*B*须保持同步时钟；如果使用序列号,那么实体*A*和实体*B*须维护双边计数器。  
  
密钥传递机制3如图12所示。  
  
1.  密钥传递机制3  
  
**密钥块签名(A1.1):** 假设实体*A*希望将一个秘密密钥*K*安全传递给实体*B*,实体*A*形成一个密钥数据块,该数据块包含接收方的可区分识别符、密钥*K*、可选的TVP(序列号或时间戳)和可选数据,然后用其私有签名变换S*A*对密钥块进行签名,产生签名后的数据块*BS*=S*A*(B\|\|*K*\|\|TVP\|\|Text1)。  
  
**密钥权标创建(A1.2):** 实体*A*构建权标数据块,它包括已签名的块*BS*和可选项Text2。实体*A*用接收者的公开加密变换E*B*加密权标数据块,附上可选的Text3,然后形成密钥权标*KTA*1=E*B*(*BS*\|\|Text2)\|\|Text3，并送给实体*B*。  
  
**密钥权标解密(B1.1):** 实体*B*使用其私有解密变换D*B*解出接收到的密钥权标加密部分。  
  
**密钥块验证(B1.2):** 实体*B*使用发送方的公开验证变换V*A*验证*BS*的完整性和来源,确认它确实是权标的接收者(通过检查*BS*中的标识符),并可选择地确认TVP在可接受的范围内(验证权标的时间性),如所有的验证都成功,实体*B*将接受该密钥*K*。  
  
1.  1：交互次数为1。  
2.  2：该机制提供实体*A*到实体*B*的实体鉴别和从实体*B*到实体*A*的隐式密钥鉴别。  
3.  3：该机制提供实体*A*到实体*B*的密钥确认,实体*B*确信它与实体*A*分享正确的密钥,但实体*A*在它收到实体*B*用密钥*K*加密答复之后,才能确信实体*B*已经收到该密钥。  
4.  4：实体*A*可选择密钥。  
5.  5：实体*B*的可区分标识符包括在被签名的密钥块*BS*中,来明确表明密钥的接收者,从而防止由实体*B*签名的块*BS*被滥用。  
6.  6：数据域Text3能用来传递实体*A*的公钥证书,在这种情况下,第12.3的第四个要求可被放宽为实体*B*拥有CA已鉴别的公开验证密钥副本。  
7.  7：如果将该密钥传递机制的两种实施方法结合起来(从实体*A*到实体*B*,从实体*B*到实体*A*),那么就可以提供相互实体鉴别和联合密钥控制(取决于可选项TVP的使用)。  
  
### 密钥传递机制4  
  
该机制适用于参与密钥传递的两个实体彼此鉴别对方身份，且在线交互两次的场景，基于GB/T 15843.3-2016中的两次交互鉴别机制,将密钥从实体*B*传递到实体*A*。应满足以下要求:  
  
1.  实体*A*有一个非对称加密系统(E*A*,D*A*)；  
2.  实体*B*有一个非对称签名系统(S*B*,V*B*)；  
3.  实体*A*可得到实体*B*已鉴别的公钥验证变换V*B*副本,可使用第13章的机制来实现；  
4.  实体*B*可得到实体*A*已鉴别的公钥加密变换E*A*副本,可使用第13章的机制来实现。  
  
密钥传递机制4如图13所示。  
  
**密钥权标创建(A1)** ：实体*A*产生一个随机数*rA*,将*rA*和可选的数据域Text1组成密钥权标*KTA*1,*KTA*1=*rA*\|\|Text1并把它送给实体*B*。  
  
**密钥块加密(B1.1)** ：假设实体*B*希望将一个秘密密钥*K*安全传递到实体*A*,实体*B*构建一个由发送者的区分标识符、密钥*K*和一可选的数据域Text2组成的密钥数据块。实体*B*用实体*A*的公钥变换E*A*将密钥数据块加密,构成加密块*BE*=E*A*（B\|\|*K*\|\|Text2）。  
  
**密钥权标创建(B1.2)** ：实体*B*可选地生成随机数*rB*,并形成权标数据块,该权标数据块由接收者的区分标识符、步骤A1中接收的随机数*rA*、新的随机数*rB*(可选)、加密块*BE*以及可选的数据域Text3组成，然后实体*B*用其私钥签名变换S*B*形成签名,附加可选的Text4,产生密钥权标*KTB*1=S*B*(A\|\|*rA*\|\|*rB*\|\|*BE*\|\|Text3)，并送给实体*A*。  
  
**密钥权标验证(A2.1)** ：实体*A*使用发送者的公钥验证变换V*B*验证接收到的公钥权标*KTB*1中的数字签名,然后实体*A*检查*KTB*1中的区分标识符,并检查接收到的值*rA*与步骤A1发送的随机数是否一致。  
  
**密钥块解密(A2.2)：** 实体*A*用其私钥解密变换D*A*解密加密块*BE*,然后验证*BE*中的发送者区分标识符。如所有检查都成功,实体*A*接受该密钥*K*。  
  
1.  1：交互次数为2。  
2.  2：该机制提供从实体*A*到实体*B*的隐式密钥鉴别。  
3.  3：该机制提供实体*B*到实体*A*的密钥确认,实体*A*确信它与实体*B*分享正确的密钥,但实体*B*在它收到实体*A*用密钥*K*加密答复之后,才能确信实体*A*已经收到该密钥。  
4.  4：实体*B*可选择密钥。  
5.  5：权标*KTA*1和*KTB*1与GB/T 15843.3-2016的第5.1.2中所描述的两次交互鉴别机制里发送的权标一致(注意此时实体*A*和实体*B*的角色互换)，通过使用*BE*\|\|Text3取代GB/T 15843.3-2016机制中的Text2，该权标能够帮助密钥*K*的传送。  
6.  6：如果该密钥传递机制在两个实体间并行执行两次,得到的相互密钥传递机制与GB/T 15843.3-2016中第5.2.3所描述的机制一致。  
7.  7：为了与GB/T 15843.3-2016保持一致性，将数据域*rB*包含在内。但由于*KTB*1中存在*BE*,*rB*在此机制中将是可选的。  
8.  密钥传递机制4  
  
### 密钥传递机制5  
  
该机制适用于参与密钥传递的两个实体采用GB/T 15843.3-2016规定的三次交互鉴别机制彼此鉴别对方身份，且在线交互三次的场景，通过相互实体鉴别的和密钥确认传递两个共享密钥，一个从实体*A*传给实体*B*,另一个从实体*B*传给实体*A*。应满足以下条件:  
  
1.  每个实体*X*有一个非对称的签名系统(S*x*,V*x*)；  
2.  每个实体*X*有一个非对称的加密系统(E*x*,D*x*)；  
3.  每个实体可得到其它实体已鉴别的公开验证变换副本,可使用第13章的机制来实现；  
4.  每个实体可得到其它实体已鉴别的公开加密变换副本,可使用第13章的机制来实现。  
  
密钥传递机制5如图14所示。  
  
1.  密钥传递机制5  
  
**密钥权标创建(A1)：** 实体*A*随机生成*rA*,构建密钥权标*KTA*1=*rA*\|\|Text1。并将其发送给实体*B*。  
  
**密钥块加密(B1.1)：** 假设实体*B*希望将一个秘密密钥*K*安全传递到实体*A*,实体*B*构建一个由它自己的区分标识符、密钥*KB*以及可选的Text2组成的块,然后用接收者的公钥加密变换E*A*加密这个块:  
  
*BE*1=E*A*(B\|\|*KB*\|\|Text2)  
  
**密钥权标创建(B1.2)** ：实体*B*随机生成*rB*,构建一个包含*rB*、*rA*、接收者标识、加密的密钥块*BE*1以及可选的Text3数据块。实体*B*用其私钥签名变换S*B*签名这个数据块，附加可选的Text4,形成密钥权标块*KTB*1，*KTB*1=S*B*(*rB*\|\|*rA*\|\|A\|\|*BE*1\|\|Text3)\|\|Text4，并发给实体*A*。  
  
**密钥权标确认(A2.1)** ：实体*A*使用实体*B*的公钥验证变换V*B*来验证实体*B*对密钥权标*KTB*1的签名。检查它在*KTB*1中的区分标识符,并检查接收到的*rA*是否与步骤A1发送的随机数一致。  
  
**密钥块解密(A2.2)** ：实体*A*使用其私钥解密变换D*A*解密加密块*BE*1,并检查实体*B*的区分标识符,如果所有的检查结果都成功,实体*A*接受密钥*KB*。  
  
**密钥块加密(A2.3)** ：实体*A*构建一个包含其区分标识符、其私钥*KA*及可选的Text5的数据块,并使用接收者的公开加密变换E*B*加密这个加密块：*BE*2=E*B*(A\|\|*KA*\|\|Text5)。  
  
**密钥权标创建(A2.4)** ：实体*A*构建一个包含随机数*rA*、随机数*rB*、接收者的区分标识符、加密的密钥块*BE*2和可选的Text6数据块。实体*A*用其私钥签名变换S*A*来签名这个数据块,附上可选的Text7，并发送这个密钥权标*KTA*2=S*A*(*rA*\|\|*rB*\|\|B\|\|*BE*2\|\|Text6\|\|Text7)给实体*B*。  
  
**密钥权标验证(B2.1)** ：实体*B*使用实体*A*的公钥验证变换V*A*验证实体*A*的签名,检查*KTA*2中它自己的区分标识符,并检查接收到的*rB*是否与步骤B1.2发送的随机数一致,此外,*B*还检查接收到的*rA*是否与*KTA*1中的数值是一致。  
  
**密钥块解密(B2.2)** ：实体*B*用其私钥变换D*B*解密加密数据块*BE*2,验证实体*A*的区分标识符,如果所有的检查成功,那么实体*B*接受密钥*KA*,如果只是要求单方密钥传输,则*BE*1或*BE*2可省略。  
  
1.  1：交互次数为3。  
2.  2：该机制提供相互实体鉴别,即实体*B*到实体*A*的*KA*隐式密钥鉴别和实体*A*到实体*B*的*KB*隐式密钥鉴别。  
3.  3：该机制对*KA*和*KB*都进行从发送端到接收端的密钥确认,此外如果实体*A*在*KB*中包含一个MAC,那么就*KB*而言,这种机制可以进行相互密钥确认。  
4.  4：由于实体*A*是发送实体，它可选择密钥*KA*。类似的,实体*B*也可选择密钥*KB*。联合密钥控制可通过将两个密钥*KA*和*KB*组合在一起构成一个共享秘密密钥*KAB*来实现。组合函数应为单向的，否则实体*A*可选择共享秘密密钥。这种机制可分类为一种密钥协商机制。  
5.  5：*KTA*1、*KTB*1和*KTA*2与GB/T 15843.3-2016第5.2.2中描述的三次交互鉴别机制中发送的密钥权标兼容。通过使用*BE*1\|\|Text3取代GB/T 15843.3-2016机制中的Text2，第二个权标能够帮助密钥*KB*的传送。通过使用*BE*2\|\|Text6取代GB/T 15843.3-2016中的Text4,第三个权标能够帮助密钥*KA*的传送,第三个权标还能够帮助Text6里的MAC的传送。  
6.  6：如果数据域Text1和Text4(或Text7和Text4)包含实体*A*和实体*B*的公钥证书,那么第12.5的第三条和第四条要求可以放宽为：两个实体都拥有CA经鉴别的公开验证密钥副本。  
  
### 密钥传递机制6  
  
该机制适用于参与密钥传递的两个实体采用以零知识技术为基础，且在线交互三次的场景，经三次交互安全传递两个密钥,一个从实体*A*到实体*B*,另一个从实体*B*到实体*A*。此外,该机制还实现相互实体鉴别及对各密钥分别进行相互密钥确认。该机制基于以下要求:  
  
1.  每个实体*X*有一个非对称的加密系统(E*X,*D*X*)；  
2.  每个实体可得到其它实体已鉴别的公开加密变换副本。可使用第13章的机制来实现。  
  
密钥传递机制6如图15所示。  
  
1.  密钥传递机制6  
  
**密钥权标创建(A1)：** 实体*A*获得一个密钥*KA*,并希望把它安全地传送给实体*B*。实体*A*选择一个随机数*rA*并构造一个包含其区分标识符、密钥*KA*、随机数*rA*以及可选的数据块Text1的密钥数据块,然后用实体*B*的公钥加密变换E*B*将密钥块加密,产生加密数据块*BE*1=E*B*(A\|\|*KA*\|\|*rA*\|\|Text1)。  
  
实体*A*构造一个密钥权标*KTA*1，它由加密数据块*BE*1及可选数据域Text2组成，*KTA*1=*BE*1\|\|Text2，并发送给实体*B*。  
  
**密钥权标创建(B1)：** 实体*B*从接收到的密钥权标*KTA*1中提取加密密钥块*BE*1,并用其私钥解密变换D*B*来将它解密,然后检查解密后的密钥块*BE*1中包含的实体*A*标识符。  
  
实体*B*获得一个密钥*KB*,并希望把它安全地传送给实体*A*。实体*B*选择一个随机数*rB*,并构造一个包含其区分标识符、密钥*KB*、随机数*rB*、随机数*rA*（从解密块提取）及可选的数据域Text3的密钥数据块。实体*B*用实体*A*的公钥加密变换E*A*将密钥块加密,构造加密数据块*BE*2=E*A*(B\|\|*KB*\|\|*rA*\|\|*rB*\|\|Text3)。  
  
实体*B*构造一个密钥权标*KTB*1，它由加密数据块*BE*2及可选数据域Text4组成，*KTB*1=*BE*2\|\|Text4，并发送给实体*A*。  
  
**密钥和实体确认(A2.1)：** 实体*A*从接收到的密钥权标*KTB*1中提取加密密钥块*BE2*,并使用其私钥解密变换D*A*将它解密。实体*A*通过比较随机数*rA*与包含在加密块*BE*2中的随机数*rA*检查密钥权标的有效性。如果验证成功,那么实体*A*确认密钥*KA*已安全到达实体*B*。  
  
**密钥权标响应(A2.2)：** 实体*A*从解密的密钥块中提取随机数*rB*,并用随机数*rB*和可选的数据域Text5构建密钥权标*KTA*2=*rB*\|\|Text5。然后实体送给实体*B*。  
  
**密钥和实体确认(B2)：** 实体*B*验证从*KTA*2提取的响应*rB*与*KTB*1中的随机数*rB*是否一致,如果验证成功,那么实体*B*就实现对实体*A*的鉴别,同时确认密钥*KB*已安全到达实体*A*。  
  
1.  1：交互次数是3。  
2.  2：该机制提供从实体*B*到实体*A*的*KA*隐式密钥鉴别，以及实体*A*到实体*B*的*KB*隐式密钥鉴别。  
3.  3：由于实体*A*是发送实体，实体*A*可选择密钥*KA*。类似的,实体*B*也可选择密钥*KB*。联合密钥控制可通过将两个密钥*KA*和*KB*组合在一起构成一个共享秘密密钥*KAB*来实现。组合函数是单向的，否则实体*B*可选择共享秘密密钥。这种机制可归类为一种密钥协商机制。  
4.  4：该机制使用非对称技术相互传递两个秘密密钥，*KA*从实体*A*传到实体*B*，*KB*从实体*B*传到实体*A*。该机制可用于如下密钥功能分离：实体*A*用密钥*KA*加密传输给实体*B*的消息以及验证来自实体*B*的认证码。实体*B*使用得到的密钥*KA*解密*A*传来的消息并生成给实体*A*的认证码。密钥*KB*的密钥功能也采用类似的方式分离。这样，非对称密钥传递机制就可拓展为密钥使用。  
5.  5：该机制以零知识技术为基础，通过使用该机制，双方实体除了自己能够计算得到的信息之外，无法获得任何其它信息。  
  
## 公钥传递  
  
### 公钥传递机制1  
  
如果实体*A*经一个受保护通道到实体*B*，（例如提供数据源鉴别及数据完整性的通道），如速递，注册邮件等，那么实体*A*可将其公钥信息直接通过该受保护通道传递给实体*B*。这是传递公钥最基本的形式。该机制需满足以下要求：  
  
1.  实体*A*的公钥信息*PKIA*至少要包含实体*A*的可区分标识符和实体*A*的公钥。此外，它还可以包含序列号，有效期，时间戳和其它数据元素；  
2.  由于公钥信息不包含任何秘密数据，所以通信信道不需提供保密性。  
  
公钥传递机制1如图16所示。  
  
1.  公钥传输机制1  
  
**密钥权标创建(A1)** ：实体*A*生成密钥权标*KTA*1，它包含实体*A*的公钥信息和可选的数据字段Text，并通过受保护的通道将*KTA*1=*PKIA*\|\|Text传给实体*B*。  
  
**密钥权标接收(B1)** ：实体*B*得到从受保护通道传递的实体*A*的密钥权标，得到实体*A*的公钥*PKIA*并将实体*A*的公钥保存在有效的公钥列表中（该列表需防止被篡改）。  
  
1.  1：该机制可用于传递公开验证密钥（对于非对称签名系统），或公开加密密钥（对于非对称加密系统），或公钥协商密钥。  
2.  2：鉴别包括数据完整性和数据源鉴别（如ISO 7498-2:1989所定义）。  
  
### 公钥传递机制2  
  
该传递机制通过不受保护的通道将实体*A*的公钥信息传递给实体*B*。为了确认完整性以及接收到公钥信息的来源，需使用另外一条鉴别通道。该机制有效地用于：当公钥信息*PKI*以电子形式通过高带宽通道传输，而公钥信息的鉴别经低带宽通道执行，如电话，速递或者注册邮件等。作为一种附加要求，如GB/T 32905所定义，实体间需共享通用的杂凑函数。需满足以下要求：  
  
1.  实体*A*的公钥信息*PKIA*至少要包含实体*A*的可区分标识符和实体*A*的公钥。此外，它还可包含序列号，有效期，时间戳和其它数据元素；  
2.  由于公钥信息不包含任何秘密数据，所以通信信道不需提供保密性。  
  
公钥传递机制2如图17所示。  
  
1.  公钥传递机制2  
  
**密钥权标创建(A1)：** 实体*A*生成密钥权标*KTA*1，它包含实体*A*的公钥信息和可选的数据字段Text，并通过不受保护的通道将*KTA*1=*PKIA*\|\|Text传给实体*B*。  
  
**密钥权标接收(B1)：** 实体*B*得到从受保护信道传递的实体*A*的密钥权标，得到实体*A*的公钥*PKIA*并且将实体*A*的公钥保存并防止被篡改，以便接下来的鉴别和使用。  
  
**验证权标创建(A2)：** 实体*A*用其公钥计算检验杂凑值hash（*PKIA*），并将这个检验值和可选的实体*A*和*B*的可区分标识符通过第二条单独的已鉴别信道（如速递或注册邮件）传输给实体*B*，其中  
  
*KTA*2=A\|\|B\|\|hash(*PKIA*)\|\|Text2。  
  
**密钥权标验证(B2)：** 一旦收到验证权标*KTA*2，实体*B*选择性的检验实体*A*和*B*的可区分标识符，根据实体*A*收到的*KTA*1里的公钥信息计算出检验值，并于*KTA*2中的检验值做比较，如果校验成功，实体*B*将实体*A*的公钥保存在有效的公钥列表中（该列表需防止被篡改）。  
  
1.  1：该机制可用于传递公开验证密钥（对于非对称签名系统），或公开加密密钥（对于非对称加密系统），或公钥协商密钥。  
2.  2：鉴别包括数据完整性和数据源鉴别。  
3.  3：如果传递的公钥用于非对称数字签名系统，而不是消息恢复，那么实体*A*可用相应的私有签名密钥对*KTA*1签名。这样，步骤B1中使用接收到的公开验证密钥进行的实体*A*的签名验证可确保实体*A*知道对应的私有签名密钥，因此可以推测，实体*A*是在权标创建时知道相应的私有签名密钥的唯一实体。如果*PKIA*中使用时间戳，那么验证可确保实体*A*当前知道相应的私有签名密钥。  
4.  4：来自实体*A*的人工签名信可用于验证权标。  
  
### 公钥传递机制3  
  
该机制通过可信第三方的身份鉴别方式从实体*A*传递一个公钥到实体*B*。使用公钥证书形式交换公钥可确保证实体的公钥鉴别。实体*A*的公钥证书包括公钥信息以及可信第三方（证书认证机构）的数字签名。引入证书认证机构将减少鉴别用户公钥的分发问题，转为证书认证机构（CA）公钥分发问题见GB/T 17901.1-AAAA。  
  
该机制基于这样假设：一个带有实体*A*公钥信息*PKIA*的有效公钥证书*CertA*由某CA机构发布，且实体*B*可获取发布公钥证书的CA机构已鉴别的公开验证变换VCA副本。  
  
公钥传递机制3如图18所示。  
  
1.  公钥传递机制3  
  
**密钥权标创建(A1)：** 实体*A*生成密钥权标*KTA*1，它包含*A*的公钥证书，并将*KTA*1=*PKIA*\|\|Text传递给实体*B*。  
  
**密钥权标验证(B1)：** 实体*B*一旦接收到公钥证书，就通过CA的公开验证变换VCA验证公钥信息，并校验实体*A*公钥的有效性。  
  
如果实体*B*希望确认实体*A*的公钥证书最近是否被取消，那么实体*B*应通过某种可信途径咨询可信第三方（如CA机构）。  
  
1.  1：交互次数为1，但实体*B*可以要求实体*A*传输公钥证书。这个额外的交互是可选的，这里不显示。实体*A*的公钥证书也可通过目录分发，在这种情况下，需在目录和实体*B*间执行公钥传输机制。  
2.  2：该机制不提供实体鉴别。  
3.  3：收到的公钥证书确认了公钥经CA鉴别。  
4.  4：实体*B*可通过鉴别方式得到CA机构的公开验证密钥VCA。可使用第13章的机制来实现。  
  

![](http://public.host.github5.com/media/fengmian.png)
# 总结 
 更多内容 可以[ 点击 访问 siduwenku.com 网站的报告 ](https://siduwenku.com/view/list/report?f=2023)进一步学习

# 友情连接
[DB37-T 1914-2011 液氨存储与装卸作业安全技术规范 山东省.pdf](http://github5.com/view/52945?f=new)

[GB/T 23023-2022 信息化和工业化融合管理体系 信息化和工业化融合管理体系.pdf](http://github5.com/view/54232?f=new)

[NIST.SP.800-45ver2 Guidelines on Electronic Mail Security.pdf](http://github5.com/view/56466?f=new)
